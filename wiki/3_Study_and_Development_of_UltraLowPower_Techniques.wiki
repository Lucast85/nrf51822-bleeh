#summary Study and development of ultra-low-power techniques and evaluation of the energy consumption measuring input current.
#labels Phase-QA

https://dl.dropboxusercontent.com/u/43091897/HostedFile/nRF51822_project/work-in-progress_BIG.png

<wiki:toc max_depth="2" />

= Introduction: Ultra Low Power =
Here is described the using of Ultra Low Power tecniques. These tips come from different sources and are joined together. Most useful tips come from:
 * [https://www.nordicsemi.com/eng/nordic/download_resource/20337/10/53074698 nRF51 Series Reference Manual V2.1, Nordic Semiconductor]
 * [http://infocenter.arm.com/help/topic/com.arm.doc.dui0497a/DUI0497A_cortex_m0_r0p0_generic_ug.pdf CorteCortexâ„¢-M0 Devices-Generic User Guide (ARM DUI 0497A)]
 * [http://www.embedded.com/design/mcus-processors-and-socs/4230085/The-basics-of-low-power-programming-on-the-Cortex-M0 The basics of low-power programming on the Cortex-M0, Joseph Yiu, ARM Ltd.]
 * [http://processors.wiki.ti.com/index.php/ULP_Advisor ULP Advisor, Texas Instruments]
 * [http://www.embedded.com/design/real-time-and-performance/4210470/1/Efficient-C-Code-for-ARM-Devices Energy efficient C code for ARM devices, Chris Shore, ARM]

Following, are developed timer's drivers. Finally they're used in a new project implementing ULP tecniques.
At the end is designed a low-current measuring circuit and is used to evaluate energy consumption of the system.

The firmware to be designed will sleep the CPU until a pulse is received from AIN4 (LPCOMP peripheral). This guarantee low power consumption during inactivity state but a timer must be on to measure time interval among two pulses. It's mandatory to use a low power timer/clock.
When the second pulse is received, the delta-time is calculated and a speed-related-information could be extrapolated.
During test phases, the current consumption are evaluated and compared among two different solutions: 
 * using of ULP tecniques (e.g. sleep the CPU during inactivity state);
 * not using of ULP tecniques;

== ULP techniques ==

Ultra Low Power techniques involve either hardware and firmware feature. 
The choosing of this IC is related to its low voltage power supply and to SOC warranties such as low component count (due to integrated radio module). However the nRF51 supports three different power supply alternatives: internal DC/DC converter setup, internal LDO setup, and Low Voltage mode setup thus, to preserve energy, DC/DC converter and LDO must be disabled.
In firmware, different solutions will be applied. E.g. hold the nRF51 in sleep mode during inactivity time, maintain Real Time Clock and interrupt from LPCOMP on.
These solutions is described in following paragraphs.


===The power management===
As mentioned above, maximum power saving mode is Low Voltage mode. Unfortunately this mode could be reach only modifying circuit topology, as shown in following schematic:
https://dl.dropboxusercontent.com/u/43091897/HostedFile/nRF51822_project/LowPowerMode.png
Since PCA10001 hasn't any DEC2 pin on external header, it's very difficult to apply this little change in circuit's topology thus I prefer use the internal LDO. This can be obtained disabling internal DC/DC and, eventually, short-circuited SB1 (equal to short-circuited AVDD and VDD), as shown in following images:

https://dl.dropboxusercontent.com/u/43091897/HostedFile/nRF51822_project/InternalLDOOnly.png

https://dl.dropboxusercontent.com/u/43091897/HostedFile/nRF51822_project/SB1_link.png

I've no short-circuited SB1 to preserve board integrity, so a small resistance (and energy wasting) is in series with supply current flowing. I think the resistance is the Rds resistance of a mosfet so it's in the order of tenth of milliohms. 
The supply voltage range is 1.8 V - 3.6 V using internal LDO regulator. I chose to supply the nRF51 with external well regulated 1.8 V to preserve power.

Firmware task to disable DC/DC converter is very simple: it's a writing operation on a register.
{{{	
   //Disable internal DC/DC step down
   NRF_POWER->DCDCEN=POWER_DCDCEN_DCDCEN_Disabled;	
}}}
===The choice of clock and timer===
===Firmware solutions to ULP----CHANGE THIS TITLE----===

{{{
	\todo 
	   /* If desired, switch off the unused RAM to lower consumption by the use of RAMON register.
       It can also be done in the application main() function. */

}}}

As described, nRF51 internal DC/DC and LDO must be disabled.
----
= Timer driver development=
----
= Using of ULP techniques among two pulses, measuring time interval =

== Setup of circuit to measure low current ==
== Measurement and comparison of energy consumption using ULP techniques or not==
----