#summary Setup of a blank project and development of comparator's driver using an external button to trigger the comparator during development and experimental phases

= Introduction =

Here are described the setup of a blank project (see [http://www2.keil.com/docs/default-source/default-document-library/mdk5-getting-started.pdf this] useful guide), the hardware to test the comparator (a button and a simple debouncing RC circuit) and the development of the comparator's driver.

----

== The setup of a blank project ==

In uVision 5.10, you can create a new project clicking on _Project->New uVision Project..._. A window will shown. Chose the project folder (create one if no exists) and create the project file (with extension .uvprojx).

https://dl.dropboxusercontent.com/u/43091897/HostedFile/nRF51822_project/select_target.png

Now select the device nRF51822_xxAA and click ok. If the device is not available, probably you've not correctly installed the nRF51 Software Development Kit (SDK). For more information about software packs on MDK 5, see [http://www2.keil.com/docs/default-source/default-document-library/mdk5-getting-started.pdf#page=14 here].
After selecting the device, the Manage Run-Time Environment window shows the related software components for this device.

https://dl.dropboxusercontent.com/u/43091897/HostedFile/nRF51822_project/ManageRunTimeEnvironment.png

To build a blank project select only _CMSIS/CORE_ and _Device/Startup_ .

=== CMSIS ===

The Cortex Microcontroller Software Interface Standard (CMSIS) provides a ground-up software framework for embedded applications that run on Cortex-M based microcontrollers. The CMSIS enables consistent and simple software interfaces to the processor and the peripherals, simplifying software reuse, reducing the learning curve for microcontroller developers (see [http://www2.keil.com/docs/default-source/default-document-library/mdk5-getting-started.pdf#page=17 here]).

*CMSIS-CORE*: Defines the API for the Cortex-M processor core and peripherals and includes a consistent system startup code. The software components CMSIS/CORE and /Device/Startup are all you need to create and run applications on the native processor that uses exceptions, interrupts, and device peripherals.

*Using CMSIS-CORE*

A native Cortex-M application with CMSIS uses the software component CMSIS/CORE, which should be used together with the software component Device/Startup. These components provide the following central files:
 * The startup_nRF51.s file with reset handler and exception vectors.
 * The system_nRF51.c configuration file for basic device setup (clock and memory BUS).
 * The nRF51.h include file for user code access to the microcontroller device.

https://dl.dropboxusercontent.com/u/43091897/HostedFile/nRF51822_project/UsingCMSIS.png

The nRF51.h header file is included in C source files and defines:

 * Peripheral Access with standardized register layout.
 * Access to Interrupts and Exceptions and the Nested Interrupt Vector Controller (NVIC).
 * Intrinsic Functions to generate special instructions, for example to activate sleep mode.
 * Systick Timer (SYSTICK) functions to configure and start a periodic timer interrupt.
 * Debug Access for printf-style I/O and ITM communication via on-chip CoreSight.

*Adding Software Components to the Project*

The files for the components CMSIS/CORE and Device/Startup are added to a project using the µVision dialog Manage Run-Time Environment. Just select the software components.
The µVision environment adds the related files.

=== Project folders arrangement ===
The starting project arrangement is the following:

https://dl.dropboxusercontent.com/u/43091897/HostedFile/nRF51822_project/ProjectFoldersArrangement.png

Now create _Source_ folder and _Include_ folder inside the project main folder. Populate the _Include_ folder with required header file (.h) and the _Source_ folder with required source code (library, .c or .cpp) files. 
To start with a new project are useful the following header files:

 * `compiler_abstraction.h`
 * `nrf.h`
 * `nfr_gpio.h`
 * `nrf51.h`
 * `nrf51:deprecated.h`
 * `pca10001.h`
 * `system_nrf51.h`

They can be copied from the _Include_ folder located in the nRF51 SDK installation path (typically in `C:\Keil_v5\ARM\Device\Nordic\nrf51822\Include`). 




=== Build the project ===

=== Download code to flash memory ===

----

== The circuit to test the comparator ==

To emulate the voltage pulse due to the crossing of the magnet above the coil was build a simple circuit. The circuit consists of a button (SW1) to trigger a positive voltage (Vcc=3 V) on a MCU's comparator pin (P0.03) and a one-pole RC circuit (R1 and C1) that remove the button's bounces.
P3 is the on-board 2x5 male pin header of the PCA10001.

https://dl.dropboxusercontent.com/u/43091897/HostedFile/nRF51822_project/debouncingRCcircuit.png

The R-C circuit has a charge-time-constant tc=10 ms and a discharge-time-constant td=20 ms thus the mechanical bounces are bypassed and button presses could be detected.

----

== The comparator's driver ==