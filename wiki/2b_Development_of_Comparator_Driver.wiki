#summary Development of comparator's driver using an external button to trigger the comparator during development and experimental phases.
#labels Phase-QA,Phase-Implementation,Phase-Design

<wiki:toc max_depth="2" />

= Introduction =
Here is described the development of LPCOMP driver, the Low Power Comparator peripheral drivers of nRF51822. The LPCOMP compares an input voltage (VIN+), which comes from an analog input pin selected through the PSEL register against a reference voltage (VIN-) selected through the REFSEL and EXTREFSEL registers. In this application is compared (VIN+) with VDD/2 (VDD*4/8).

https://dl.dropboxusercontent.com/u/43091897/HostedFile/nRF51822_project/LPCOMP.png

Every time VIN+ rises above VIN- (the button is pressed->upward crossing), LED 0 of the board will change his state. According to this specifications a simple circuit was build.
  
----

== The circuit to test the comparator ==

To emulate the voltage pulse due to the crossing of the magnet above the coil was build a simple circuit. The circuit consists of a button (SW1) to trigger a positive voltage (Vcc=3 V) on a MCU's comparator pin (P0.03) and a one-pole RC circuit (R1 and C1) that remove the button's bounces.
P3 is the on-board 2x5 male pin header of the PCA10001.

https://dl.dropboxusercontent.com/u/43091897/HostedFile/nRF51822_project/debouncingRCcircuit.png

The R-C circuit has a charge-time-constant tc=10 ms and a discharge-time-constant td=20 ms thus the mechanical bounces are bypassed and button presses could be detected.
Once the button is pressed, a positive 3 V  voltage is at pin P0.03 and the upward crossing will generate an UP event of LPCOMP. This event will change the state of LED 0.
_NOTE: P0.03 correspond to the ADC/LPCOMP input 4 (AIN4)._

----

== The comparator's driver ==

The [https://www.nordicsemi.com/eng/nordic/download_resource/20337/10/53074698 nRF51 Series Reference Manual], in chapter 31, describe the Low Power Comparator characteristics. Thus, I develop the driver following this manual.

Starting from the blank project of task 2a_Setup_of_a_Blank_Project , let's to create two new files:
 * nrf51_LPCOMP.c
 * nrf51_LPCOMP.h